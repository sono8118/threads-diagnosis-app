# 結果ページ（P-002）E2Eテスト仕様書

生成日: 2026-01-15
対象ページ: `/result`
権限レベル: ゲスト（匿名）

---

## テスト環境

```yaml
URL: http://localhost:3247/result
認証: 不要（ゲスト利用）
前提条件:
  - 診断ページ（P-001）で12問に回答済み
  - sessionStorageに診断データが保存されている
```

---

## プロジェクト固有の特徴

**このプロジェクトはフロントエンドのみ（バックエンドなし）**
- バックエンド統合テストは存在しない
- すべてのロジックがフロントエンドで完結
- sessionStorageにデータを保存（ブラウザタブを閉じると削除）
- E2Eテストは **UIフローのみ** を検証

---

## E2Eに含めないもの（範囲外）

以下はE2Eテストの範囲外です:

| 除外項目 | 理由 |
|---------|------|
| ❌ レスポンシブ表示 | E2E範囲外（目視確認） |
| ❌ アクセシビリティ | E2E範囲外（axe-core等） |
| ❌ パフォーマンス | E2E範囲外（Lighthouse等） |
| ❌ sessionStorageのデータ構造検証 | ユニットテストでカバー |
| ❌ スコア計算ロジック検証 | ユニットテストでカバー |
| ❌ タイプ判定ロジック検証 | ユニットテストでカバー |
| ❌ カスタムメッセージ生成ロジック検証 | ユニットテストでカバー |

---

## E2Eテスト項目一覧（UIフローのみ: 7項目）

| ID | テスト項目 | 期待結果 |
|----|----------|---------|
| E2E-RESULT-001 | sessionStorageにデータがない場合のリダイレクト | 診断トップ（`/`）へリダイレクト |
| E2E-RESULT-002 | 結果ページの表示確認（タイプ別6パターン） | タイプ名、状態説明、スコア、レーダーチャートが表示される |
| E2E-RESULT-003 | レーダーチャート表示確認 | 4軸スコアがレーダーチャートで可視化される |
| E2E-RESULT-004 | カスタムメッセージ表示確認 | 1-2個のカスタムメッセージが表示される |
| E2E-RESULT-005 | 次の一手表示確認 | 「まずできそうなこと」「少し慣れたら」「余裕が出てきたら」が表示される |
| E2E-RESULT-006 | 商品提案CTA表示・クリック | タイプ別のCTAが表示され、クリックすると別タブでLPが開く |
| E2E-RESULT-007 | スクショ推奨案内表示確認 | 「診断結果はこのページだけで表示されます」のメッセージが表示される |

---

## テスト詳細

### E2E-RESULT-001: sessionStorageにデータがない場合のリダイレクト

**目的**: sessionStorageにデータがない場合、診断トップへリダイレクトする

**前提条件**:
- sessionStorageに `threads_diagnosis_session` が存在しない

**操作手順**:
1. sessionStorageをクリア
2. `/result` に直接アクセス

**期待結果**:
- 診断トップ（`/`）へリダイレクトされる

**検証ポイント**:
- URLが `/` に変更される

---

### E2E-RESULT-002: 結果ページの表示確認（タイプ別6パターン）

**目的**: タイプ別に結果ページが正しく表示されることを確認

**前提条件**:
- sessionStorageに診断データが保存されている
- タイプ: BEGINNER, T1, T2, T3, T4, BALANCED のいずれか

**操作手順**:
1. 診断ページで12問に回答
2. 結果ページに遷移

**期待結果**:
- タイプ名が表示される（例: 「迷子タイプ」）
- 状態説明が表示される（例: 「誰に何を届けるかがまだ定まっていない状態」）
- スコアが表示される（BEGINNER: 「現在地：スタート地点」、その他: 「総合スコア：N / 100」）

**検証ポイント**:
- タイプ名、状態説明、スコアが正しく表示される

**テストパターン**:
- 6タイプすべてのパターンでテスト（BEGINNER, T1, T2, T3, T4, BALANCED）

---

### E2E-RESULT-003: レーダーチャート表示確認

**目的**: 4軸スコアがレーダーチャートで可視化されることを確認

**前提条件**:
- sessionStorageに診断データが保存されている

**操作手順**:
1. 結果ページに遷移
2. レーダーチャートセクションをスクロール

**期待結果**:
- レーダーチャートが表示される
- 4軸のラベル（設計力、量産力、改善力、事業力）が表示される
- 各軸のスコアが可視化される

**検証ポイント**:
- レーダーチャート（SVG要素）が存在する
- 4軸のラベルが表示される

---

### E2E-RESULT-004: カスタムメッセージ表示確認

**目的**: カスタムメッセージが1-2個表示されることを確認

**前提条件**:
- sessionStorageに診断データが保存されている

**操作手順**:
1. 結果ページに遷移
2. 「今のあなたの状態を、言葉にすると」セクションをスクロール

**期待結果**:
- 1-2個のカスタムメッセージが表示される
- メッセージは左側に青いボーダーラインが表示される

**検証ポイント**:
- カスタムメッセージブロックが存在する
- メッセージが1-2個表示される

---

### E2E-RESULT-005: 次の一手表示確認

**目的**: 次の一手（今日/今週/今月）が表示されることを確認

**前提条件**:
- sessionStorageに診断データが保存されている

**操作手順**:
1. 結果ページに遷移
2. 「これからの一歩」セクションをスクロール

**期待結果**:
- 「まずできそうなこと」が表示される（🟢）
- 「少し慣れたら」が表示される（🔵）
- 「余裕が出てきたら」が表示される（🟣）

**検証ポイント**:
- 3つのステップが表示される
- 各ステップに絵文字とテキストが含まれる

---

### E2E-RESULT-006: 商品提案CTA表示・クリック

**目的**: タイプ別のCTAが表示され、クリックすると別タブでLPが開くことを確認

**前提条件**:
- sessionStorageに診断データが保存されている
- 環境変数 `VITE_LP_URL` が設定されている

**操作手順**:
1. 結果ページに遷移
2. 商品提案CTAセクションをスクロール
3. 「Threadsがラクになる方法を見てみる」ボタンをクリック

**期待結果**:
- タイプ別のCTAタイトルと説明文が表示される
- ボタンをクリックすると別タブでLPが開く
- LPのURLにUTMパラメータが付与される（例: `?utm_source=diagnosis&utm_medium=app&utm_campaign=threads_manager&utm_content=T1&utm_term=score_72`）

**検証ポイント**:
- CTAタイトル、説明文、ボタンが表示される
- ボタンクリック時に別タブが開く
- GA4イベント `CTA_Click` が送信される（dataLayerで確認）

**テストパターン**:
- 6タイプすべてのパターンでテスト（BEGINNER, T1, T2, T3, T4, BALANCED）

---

### E2E-RESULT-007: スクショ推奨案内表示確認

**目的**: スクショ推奨案内が表示されることを確認

**前提条件**:
- sessionStorageに診断データが保存されている

**操作手順**:
1. 結果ページに遷移
2. ページ上部を確認

**期待結果**:
- 「📸 診断結果はこのページだけで表示されます。スクリーンショットで保存しておくと便利です。」が表示される

**検証ポイント**:
- スクショ推奨案内が表示される

---

## GA4イベント検証（オプション）

E2Eテストでは **GA4イベントの送信確認は範囲外** ですが、手動で確認する場合は以下の手順で検証できます:

| イベント名 | 発火タイミング | 検証方法 |
|-----------|--------------|---------|
| `Result_View` | 結果ページ表示時 | `window.dataLayer` を確認 |
| `CTA_View` | CTA表示時（インプレッション） | `window.dataLayer` を確認 |
| `CTA_Click` | CTAボタンクリック時 | `window.dataLayer` を確認 |

**検証方法（ブラウザコンソール）**:
```javascript
// dataLayerを確認
console.log(window.dataLayer);

// 最新のイベントを確認
console.log(window.dataLayer[window.dataLayer.length - 1]);
```

---

## テストデータ準備

### sessionStorageに保存するテストデータ

E2Eテストで使用するsessionStorageデータの例:

```javascript
// T1（迷子タイプ）のテストデータ
const testData = {
  answers: [
    { questionId: 1, value: 0 },
    { questionId: 2, value: 0 },
    { questionId: 3, value: 0 },
    { questionId: 4, value: 6 },
    { questionId: 5, value: 6 },
    { questionId: 6, value: 6 },
    { questionId: 7, value: 6 },
    { questionId: 8, value: 6 },
    { questionId: 9, value: 6 },
    { questionId: 10, value: 6 },
    { questionId: 11, value: 6 },
    { questionId: 12, value: 6 }
  ],
  computedScores: {
    design: 0,        // 最低軸 → T1
    production: 75,
    improvement: 75,
    business: 75
  },
  computedType: 'T1',
  customMessages: [
    '誰に何を届けるかが定まっていない状態です。まずはターゲット設定から始めましょう。',
    '改善ループが存在していない状態です。頑張りが積み上がらない構造になっています。'
  ],
  timestamp: Date.now()
};

// sessionStorageに保存
sessionStorage.setItem('threads_diagnosis_session', JSON.stringify(testData));
```

### タイプ別テストデータ

| タイプ | 最低軸 | computedType | 期待されるタイプ名 |
|--------|--------|-------------|-----------------|
| BEGINNER | 全軸0点 | 'BEGINNER' | はじまりタイプ |
| T1 | design: 0 | 'T1' | 迷子タイプ |
| T2 | production: 0 | 'T2' | 整え途中タイプ |
| T3 | improvement: 0 | 'T3' | 伸ばせるタイプ |
| T4 | business: 0 | 'T4' | もったいないタイプ |
| BALANCED | 全軸85点以上 | 'BALANCED' | 安定成長タイプ |

---

## 実行コマンド

```bash
# Playwrightテストを実行（実装後）
npx playwright test tests/e2e/result.spec.ts

# ヘッドレスモードで実行
npx playwright test tests/e2e/result.spec.ts --headed

# デバッグモード
npx playwright test tests/e2e/result.spec.ts --debug

# 特定のテストのみ実行
npx playwright test tests/e2e/result.spec.ts -g "E2E-RESULT-001"
```

---

## 品質確認チェックリスト

| 確認項目 | チェック |
|---------|---------|
| E2E項目数が5-10項目以内か？ | ✅ 7項目 |
| UIフローのみをテストしているか？ | ✅ |
| バックエンドテストの重複はないか？ | ✅（バックエンドなし） |
| ユニットテストで検証すべき項目は除外したか？ | ✅ |
| レスポンシブテストは除外したか？ | ✅ |
| アクセシビリティテストは除外したか？ | ✅ |
| パフォーマンステストは除外したか？ | ✅ |

---

**作成日**: 2026-01-15
**次のステップ**: @E2Eテスト実装エージェントによるPlaywrightコード実装
